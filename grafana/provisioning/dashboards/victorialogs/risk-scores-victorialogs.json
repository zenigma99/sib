{
  "annotations": {"list": []},
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
      "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0},
      "id": 1,
      "options": {
        "colorMode": "background_solid",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false},
        "textMode": "value_and_name"
      },
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "#EAB839", "value": 10000},
              {"color": "orange", "value": 50000},
              {"color": "red", "value": 100000}
            ]
          },
          "unit": "short",
          "noValue": "0",
          "displayName": "Risk Score"
        }
      },
      "targets": [
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Critical | stats count() as Critical",
          "queryType": "stats",
          "refId": "A"
        },
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Error | stats count() as Error",
          "queryType": "stats",
          "refId": "B"
        },
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Warning | stats count() as Warning",
          "queryType": "stats",
          "refId": "C"
        },
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Notice | stats count() as Notice",
          "queryType": "stats",
          "refId": "D"
        }
      ],
      "transformations": [
        {"id": "merge", "options": {}},
        {"id": "calculateField", "options": {"alias": "CritW", "mode": "binary", "binary": {"left": "Critical", "operator": "*", "right": "25"}}},
        {"id": "calculateField", "options": {"alias": "ErrW", "mode": "binary", "binary": {"left": "Error", "operator": "*", "right": "10"}}},
        {"id": "calculateField", "options": {"alias": "WarnW", "mode": "binary", "binary": {"left": "Warning", "operator": "*", "right": "3"}}},
        {"id": "calculateField", "options": {"alias": "NotW", "mode": "binary", "binary": {"left": "Notice", "operator": "*", "right": "1"}}},
        {"id": "calculateField", "options": {"alias": "Sum1", "mode": "binary", "binary": {"left": "CritW", "operator": "+", "right": "ErrW"}}},
        {"id": "calculateField", "options": {"alias": "Sum2", "mode": "binary", "binary": {"left": "WarnW", "operator": "+", "right": "NotW"}}},
        {"id": "calculateField", "options": {"alias": "Risk Score", "mode": "binary", "binary": {"left": "Sum1", "operator": "+", "right": "Sum2"}}},
        {"id": "organize", "options": {"excludeByName": {"Critical": true, "Error": true, "Warning": true, "Notice": true, "CritW": true, "ErrW": true, "WarnW": true, "NotW": true, "Sum1": true, "Sum2": true}, "indexByName": {"Risk Score": 0}}}
      ],
      "title": "Security Posture",
      "description": "Total weighted risk score. Green = Healthy, Yellow = Elevated, Orange = High, Red = Critical",
      "type": "stat"
    },
    {
      "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
      "gridPos": {"h": 4, "w": 3, "x": 6, "y": 0},
      "id": 2,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {"calcs": ["sum"], "fields": "", "values": false},
        "textMode": "value_and_name"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {"mode": "absolute", "steps": [{"color": "dark-red", "value": null}]},
          "color": {"mode": "thresholds"},
          "noValue": "0",
          "displayName": "Critical"
        }
      },
      "targets": [
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Critical | stats count()",
          "queryType": "stats",
          "refId": "A"
        }
      ],
      "title": "",
      "type": "stat"
    },
    {
      "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
      "gridPos": {"h": 4, "w": 3, "x": 9, "y": 0},
      "id": 3,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {"calcs": ["sum"], "fields": "", "values": false},
        "textMode": "value_and_name"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}]},
          "color": {"mode": "thresholds"},
          "noValue": "0",
          "displayName": "Error"
        }
      },
      "targets": [
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Error | stats count()",
          "queryType": "stats",
          "refId": "A"
        }
      ],
      "title": "",
      "type": "stat"
    },
    {
      "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
      "gridPos": {"h": 4, "w": 3, "x": 6, "y": 4},
      "id": 4,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {"calcs": ["sum"], "fields": "", "values": false},
        "textMode": "value_and_name"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {"mode": "absolute", "steps": [{"color": "orange", "value": null}]},
          "color": {"mode": "thresholds"},
          "noValue": "0",
          "displayName": "Warning"
        }
      },
      "targets": [
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Warning | stats count()",
          "queryType": "stats",
          "refId": "A"
        }
      ],
      "title": "",
      "type": "stat"
    },
    {
      "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
      "gridPos": {"h": 4, "w": 3, "x": 9, "y": 4},
      "id": 5,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {"calcs": ["sum"], "fields": "", "values": false},
        "textMode": "value_and_name"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {"mode": "absolute", "steps": [{"color": "blue", "value": null}]},
          "color": {"mode": "thresholds"},
          "noValue": "0",
          "displayName": "Notice"
        }
      },
      "targets": [
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Notice | stats count()",
          "queryType": "stats",
          "refId": "A"
        }
      ],
      "title": "",
      "type": "stat"
    },
    {
      "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
      "id": 10,
      "options": {
        "legend": {"calcs": [], "displayMode": "list", "placement": "bottom"},
        "tooltip": {"mode": "multi", "sort": "desc"}
      },
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "drawStyle": "line",
            "fillOpacity": 30,
            "gradientMode": "opacity",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "never",
            "stacking": {"mode": "none"}
          }
        },
        "overrides": [
          {"matcher": {"id": "byName", "options": "Critical"}, "properties": [{"id": "color", "value": {"fixedColor": "dark-red", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "Error"}, "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "Warning"}, "properties": [{"id": "color", "value": {"fixedColor": "orange", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "Notice"}, "properties": [{"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}}]}
        ]
      },
      "targets": [
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Critical | stats count()",
          "legendFormat": "Critical",
          "queryType": "statsRange",
          "refId": "A"
        },
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Error | stats count()",
          "legendFormat": "Error",
          "queryType": "statsRange",
          "refId": "B"
        },
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Warning | stats count()",
          "legendFormat": "Warning",
          "queryType": "statsRange",
          "refId": "C"
        },
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Notice | stats count()",
          "legendFormat": "Notice",
          "queryType": "statsRange",
          "refId": "D"
        }
      ],
      "title": "Event Trend",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
      "gridPos": {"h": 10, "w": 14, "x": 0, "y": 8},
      "id": 20,
      "options": {
        "showHeader": true,
        "cellHeight": "md",
        "footer": {"show": false, "reducer": ["sum"], "fields": ""},
        "sortBy": [{"desc": true, "displayName": "Risk"}]
      },
      "fieldConfig": {
        "defaults": {
          "custom": {"align": "left", "cellOptions": {"type": "auto"}, "inspect": false, "filterable": false}
        },
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "Host"},
            "properties": [
              {"id": "custom.width", "value": 160},
              {"id": "links", "value": [{"title": "View in Events Explorer", "url": "/d/events-explorer-victorialogs?var-hostname=${__value.text}"}]}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Risk"},
            "properties": [
              {"id": "custom.width", "value": 100},
              {"id": "custom.cellOptions", "value": {"type": "gauge", "mode": "gradient", "valueDisplayMode": "text"}},
              {"id": "color", "value": {"mode": "thresholds"}},
              {"id": "thresholds", "value": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 10000}, {"color": "orange", "value": 50000}, {"color": "red", "value": 100000}]}},
              {"id": "min", "value": 0},
              {"id": "max", "value": 200000}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Status"},
            "properties": [
              {"id": "custom.width", "value": 100},
              {"id": "mappings", "value": [
                {"type": "range", "options": {"from": 0, "to": 9999, "result": {"text": "ðŸŸ¢ Low", "color": "green"}}},
                {"type": "range", "options": {"from": 10000, "to": 49999, "result": {"text": "ðŸŸ¡ Medium", "color": "yellow"}}},
                {"type": "range", "options": {"from": 50000, "to": 99999, "result": {"text": "ðŸŸ  High", "color": "orange"}}},
                {"type": "range", "options": {"from": 100000, "to": 9999999999, "result": {"text": "ðŸ”´ Critical", "color": "red"}}}
              ]}
            ]
          },
          {"matcher": {"id": "byName", "options": "Critical"}, "properties": [{"id": "custom.width", "value": 70}]},
          {"matcher": {"id": "byName", "options": "Error"}, "properties": [{"id": "custom.width", "value": 60}]},
          {"matcher": {"id": "byName", "options": "Warning"}, "properties": [{"id": "custom.width", "value": 70}]},
          {"matcher": {"id": "byName", "options": "Notice"}, "properties": [{"id": "custom.width", "value": 60}]}
        ]
      },
      "targets": [
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Critical | stats by (hostname) count() as Critical",
          "queryType": "stats",
          "refId": "Critical",
          "instant": true
        },
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Error | stats by (hostname) count() as Error",
          "queryType": "stats",
          "refId": "Error",
          "instant": true
        },
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Warning | stats by (hostname) count() as Warning",
          "queryType": "stats",
          "refId": "Warning",
          "instant": true
        },
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall priority:Notice | stats by (hostname) count() as Notice",
          "queryType": "stats",
          "refId": "Notice",
          "instant": true
        }
      ],
      "title": "Host Risk Assessment",
      "description": "Click a host to investigate in Events Explorer",
      "transformations": [
        {"id": "merge", "options": {}},
        {"id": "organize", "options": {
          "excludeByName": {"Time": true},
          "renameByName": {"hostname": "Host"}
        }},
        {"id": "calculateField", "options": {"alias": "CritW", "mode": "binary", "binary": {"left": "Critical", "operator": "*", "right": "25"}}},
        {"id": "calculateField", "options": {"alias": "ErrW", "mode": "binary", "binary": {"left": "Error", "operator": "*", "right": "10"}}},
        {"id": "calculateField", "options": {"alias": "WarnW", "mode": "binary", "binary": {"left": "Warning", "operator": "*", "right": "3"}}},
        {"id": "calculateField", "options": {"alias": "NotW", "mode": "binary", "binary": {"left": "Notice", "operator": "*", "right": "1"}}},
        {"id": "calculateField", "options": {"alias": "Sum1", "mode": "binary", "binary": {"left": "CritW", "operator": "+", "right": "ErrW"}}},
        {"id": "calculateField", "options": {"alias": "Sum2", "mode": "binary", "binary": {"left": "WarnW", "operator": "+", "right": "NotW"}}},
        {"id": "calculateField", "options": {"alias": "Risk", "mode": "binary", "binary": {"left": "Sum1", "operator": "+", "right": "Sum2"}}},
        {"id": "organize", "options": {
          "excludeByName": {"CritW": true, "ErrW": true, "WarnW": true, "NotW": true, "Sum1": true, "Sum2": true},
          "indexByName": {"Host": 0, "Risk": 1, "Critical": 2, "Error": 3, "Warning": 4, "Notice": 5}
        }},
        {"id": "sortBy", "options": {"fields": {}, "sort": [{"field": "Risk", "desc": true}]}}
      ],
      "type": "table"
    },
    {
      "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
      "gridPos": {"h": 10, "w": 10, "x": 14, "y": 8},
      "id": 21,
      "options": {
        "legend": {"calcs": ["sum"], "displayMode": "table", "placement": "right", "sortBy": "Total", "sortDesc": true},
        "pieType": "donut",
        "reduceOptions": {"calcs": ["sum"], "fields": "", "values": false},
        "tooltip": {"mode": "single"}
      },
      "fieldConfig": {
        "defaults": {"color": {"mode": "palette-classic"}, "unit": "short"}
      },
      "targets": [
        {
          "datasource": {"type": "victoriametrics-logs-datasource", "uid": "victorialogs"},
          "expr": "source:syscall | stats by (rule) count()",
          "legendFormat": "{{rule}}",
          "queryType": "stats",
          "refId": "A"
        }
      ],
      "title": "Top Detection Rules",
      "type": "piechart"
    },
    {
      "gridPos": {"h": 2, "w": 24, "x": 0, "y": 18},
      "id": 100,
      "options": {
        "code": {"language": "plaintext", "showLineNumbers": false, "showMiniMap": false},
        "content": "**Risk Score** = (Critical Ã— 25) + (Error Ã— 10) + (Warning Ã— 3) + (Notice Ã— 1) â€” **Status**: ðŸŸ¢ Low (<10k) â€¢ ðŸŸ¡ Medium (10k-50k) â€¢ ðŸŸ  High (50k-100k) â€¢ ðŸ”´ Critical (100k+)",
        "mode": "markdown"
      },
      "type": "text"
    }
  ],
  "refresh": "30s",
  "schemaVersion": 39,
  "tags": ["security", "falco", "sib", "risk", "executive", "victorialogs"],
  "templating": {"list": []},
  "time": {"from": "now-24h", "to": "now"},
  "timepicker": {},
  "timezone": "browser",
  "title": "Host Risk Scores (VictoriaLogs)",
  "uid": "sib-risk-scores-victorialogs",
  "version": 1
}
