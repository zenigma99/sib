services:
  ansible:
    build:
      context: .
      dockerfile: Dockerfile
    image: sib-ansible:latest
    volumes:
      # Mount ansible directory
      - .:/ansible:ro
      # Mount detection config for pushing to fleet (falco.yaml + rules)
      - ../detection/config:/detection-config:ro
      # Mount SSH keys from host
      - ~/.ssh:/root/.ssh:ro
      # Mount SSH agent socket (for macOS/Linux)
      - ${SSH_AUTH_SOCK:-/dev/null}:/ssh-agent
    environment:
      - SSH_AUTH_SOCK=/ssh-agent
      - ANSIBLE_HOST_KEY_CHECKING=false
      - ANSIBLE_FORCE_COLOR=true
      - DETECTION_CONFIG_PATH=/detection-config
    working_dir: /ansible
    network_mode: host
