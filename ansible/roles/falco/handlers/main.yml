---
# Falco role handlers

- name: Restart Falco
  ansible.builtin.shell: |
    if systemctl is-enabled falco-modern-bpf 2>/dev/null; then
      systemctl restart falco-modern-bpf
    else
      systemctl restart falco
    fi
  when:
    - effective_deployment | default('docker') | trim == 'native'
    - not (is_lxc | default(false))

- name: Restart Falco Docker
  community.docker.docker_container:
    name: sib-falco
    state: started
    restart: true
  when:
    - effective_deployment | default('docker') | trim == 'docker'
    - not (is_lxc | default(false))
  listen: Restart Falco

- name: Restart Falco container
  community.docker.docker_container:
    name: sib-falco
    state: started
    restart: true
  when: not (is_lxc | default(false))
